{% extends 'base.html' %}

{% block header %}
<h1>{% block title %}Editing the thing '{{g.thing.endpoint_id}}' {% endblock %}</h1>
{% endblock %}

{% block content %}
{% if g.user %}

<script type='text/javascript'>
var capabilityId = {{ g.thing_capabilities | length }};

function add_capability() {
    capabilityId++;
    var containerEl = document.getElementById('alexa_capabilities')
	var liEl = document.createElement('li');
	liEl.setAttribute('id', 'alexa_capability_li_' + capabilityId)
    liEl.innerHTML = `
        <select name="alexa_capability" id="alexa_capability_` + capabilityId + `">
            {% for alexa_capability in alexa_capabilities %}
            <option value="{{ alexa_capability['id'] }}">{{ alexa_capability['name'] }}</option>
            {% endfor %}
        </select>
        <input name="alexa_capability_properties" id="alexa_capability_properties_1" value="">
        <span>
            <button type="button" onclick="remove_capability(` + capabilityId + `);">-</button>
        </span>
    `;

    containerEl.appendChild(liEl)
}

function remove_capability(id) {
   document.getElementById('alexa_capability_li_' + id).remove();
}
</script>

<a href="{{ url_for('thing.thing_list') }}" id="list">List</a>
<a href="{{ url_for('thing.thing_view', thing_id=g.thing['id']) }}" id="view">View</a>

<form method="post" id="form-edit">
    <label for="endpoint_id">Name ("EndpointId" - unique device id)</label>
    <input name="endpoint_id" id="endpoint_id" value="{{ g.thing['endpoint_id'] }}">

    <label for="friendly_name">Friendly Name</label>
    <input name="friendly_name" id="friendly_name" value="{{ g.thing['friendly_name'] }}">

    <label for="description">Description</label>
    <input name="description" id="description" value="{{ g.thing['description'] }}">

    <label for="manufacturer_name">Manufacturer Name</label>
    <input name="manufacturer_name" id="manufacturer_name" value="{{ g.thing['manufacturer_name'] }}">

    <label for="alexa_category">Alexa Category</label>
    <select name="alexa_category" id="alexa_category">
        {% for alexa_category in alexa_categories %}
        {% if g.thing['alexa_category_id'] == alexa_category['id'] %}
        <option value="{{ alexa_category['id'] }}" selected="selected">{{ alexa_category['name'] }}</option>
        {% else %}
        <option value="{{ alexa_category['id'] }}">{{ alexa_category['name'] }}</option>
        {% endif %}
        {% endfor %}
    </select>

    <label for="alexa_capability_1">Alexa Capabilities and their Properties</label>
    <ul id="alexa_capabilities">
        {% if g.thing_capabilities | length == 0%}
        <li id="alexa_capability_li_1">
            <select name="alexa_capability" id="alexa_capability_1">
                {% for alexa_capability in alexa_capabilities %}
                <option value="{{ alexa_capability['id'] }}">{{ alexa_capability['name'] }}</option>
                {% endfor %}
            </select>
            <input name="alexa_capability_properties" id="alexa_capability_properties_1" value=""/>
            <span>
                <button type="button"  onclick="add_capability();">+</button>
            </span>
        </li>
        {% endif %}
        {% for thing_capability in g.thing_capabilities %}
        <li id="alexa_capability_li_{{ loop.index }}">
            <select name="alexa_capability" id="alexa_capability_{{ loop.index }}">
                {% for alexa_capability in alexa_capabilities %}
                {% if thing_capability['id'] == alexa_capability['id'] %}
                <option value="{{ alexa_capability['id'] }}" selected="selected">{{ alexa_capability['name'] }}</option>
                {% else %}
                <option value="{{ alexa_capability['id'] }}">{{ alexa_capability['name'] }}</option>
                {% endif %}
                {% endfor %}
            </select>
            <input name="alexa_capability_properties" id="alexa_capability_properties_{{ loop.index }}"
                value="{{ thing_capability['properties'] }}"/>
            {% if loop.index == 1 %}
            <span >
                <button type="button"  onclick="add_capability();">+</button>
            </span>
            {% else %}
            <span >
                <button type="button"  onclick="remove_capability({{ loop.index }});">-</button>
            </span>
            {% endif %}
        </li>
        {% endfor %}
    </ul>


    <input type="submit" value="Update">
</form>
{% endif %}
{% endblock %}